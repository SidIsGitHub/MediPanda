<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MediPanda</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com">
        const deviceId = "user_" + Math.random().toString(36).substr(2, 9);
        // Generate a unique ID for this phone
        if (!deviceId) {
            deviceId = "user_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem("paws_device_id", deviceId);
        }
        console.log("My User ID:", deviceId);
    </script>

    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

    <style>
        /* --- NEW AUTH SCREEN STYLES --- */

        /* 1. The Apple-style Mesh Gradient Background */
        .auth-bg-gradient {
            background: radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* 2. The Glass Card Effect */
        .glass-panel {
            background: rgba(28, 28, 30, 0.65);
            /* Dark semi-transparent */
            backdrop-filter: blur(25px);
            /* Heavy Blur (Apple Style) */
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: "Inter", sans-serif;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* The iOS-style Spring Animation */
        .ios-spring {
            transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            /* Apple's "Spring" curve */
        }

        .fade-enter {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        .fade-enter-active {
            opacity: 1;
            transform: scale(1);
        }

        /* --- ADD THESE NEW STYLES INSIDE YOUR EXISTING <style> TAG --- */

        /* 1. Dark Mode Base */
        body {
            background-color: #09090b;
            color: #ffffff;
            /* White text by default */
        }

        /* 2. Apple Music Style Animated Gradients */
        .animated-gradient-1 {
            background: linear-gradient(135deg, #ff4b1f, #ff9068);
            background-size: 200% 200%;
            animation: gradientMove 6s ease infinite;
        }

        .animated-gradient-2 {
            background: linear-gradient(135deg, #8E2DE2, #4A00E0);
            background-size: 200% 200%;
            animation: gradientMove 8s ease infinite;
        }

        @keyframes gradientMove {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* 3. Utility to hide scrollbars for a cleaner look */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* iOS-style Fluid Expansion */
        .app-transition {
            transition:
                top 0.5s cubic-bezier(0.32, 0.72, 0, 1),
                left 0.5s cubic-bezier(0.32, 0.72, 0, 1),
                width 0.5s cubic-bezier(0.32, 0.72, 0, 1),
                height 0.5s cubic-bezier(0.32, 0.72, 0, 1),
                border-radius 0.5s cubic-bezier(0.32, 0.72, 0, 1),
                opacity 0.2s ease-out;
            /* Faster fade for the container itself */
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.75);
            /* Deeper shadow during flight */
        }

        /* Content Fade Logic - The Secret to Smoothness */
        .content-hidden {
            opacity: 0;
            transform: scale(0.98);
            /* Slight zoom out effect */
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }

        .content-visible {
            opacity: 1;
            transform: scale(1);
            /* Delay fade-in until card is mostly open (0.3s delay) */
            transition: opacity 0.4s ease-out 0.3s, transform 0.4s ease-out 0.3s;
        }
    </style>
</head>

<body class="h-[100dvh] flex flex-col overflow-hidden bg-[#121212]">
    <div id="auth-screen" class="fixed inset-0 z-[100] bg-[#050505] overflow-y-auto transition-all duration-500">

        <div class="fixed inset-0 auth-bg-gradient z-0 opacity-60 pointer-events-none"></div>

        <img src="assets/panda-paw.svg"
            class="fixed -bottom-40 -right-40 w-[180vw] max-w-[1000px] opacity-[0.03] rotate-[25deg] z-0 pointer-events-none select-none"
            alt="Background Decoration">

        <div class="min-h-full w-full flex flex-col items-center justify-center py-12 px-6 relative z-10">

            <div class="text-center mb-8 w-full max-w-sm">
                <div class="relative mx-auto w-40 h-40 mb-2 flex items-center justify-center">
                    <div class="absolute inset-0 bg-pink-500 blur-[60px] opacity-20 rounded-full"></div>
                    <img src="assets/panda-paw.svg"
                        class="relative w-full h-full drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)] object-contain"
                        alt="MediPanda Logo">
                </div>

                <h1 class="text-4xl font-extrabold text-white tracking-tight mb-2 drop-shadow-md">MediPanda</h1>
                <p class="text-pink-200/60 font-medium tracking-wide text-sm">Your Health. Simplified.</p>
            </div>

            <div class="w-full max-w-sm glass-panel rounded-[32px] p-1 border border-white/10 shadow-2xl relative">

                <div class="flex bg-black/20 p-1 m-4 rounded-2xl backdrop-blur-md">
                    <button onclick="toggleAuthMode('login')" id="tab-login"
                        class="flex-1 py-3 text-sm font-bold rounded-xl bg-white/10 text-white shadow-sm transition-all border border-white/5">Log
                        In</button>
                    <button onclick="toggleAuthMode('register')" id="tab-register"
                        class="flex-1 py-3 text-sm font-bold rounded-xl text-zinc-400 hover:text-white transition-all">Sign
                        Up</button>
                </div>

                <div class="px-6 pb-6 space-y-5">

                    <div id="register-avatar" class="hidden flex-col items-center justify-center mb-2 mt-2">
                        <div class="relative group cursor-pointer transition-transform active:scale-95"
                            onclick="document.getElementById('reg-photo-input').click()">
                            <div id="reg-photo-preview"
                                class="w-28 h-28 rounded-full bg-black/40 border-2 border-white/10 overflow-hidden flex items-center justify-center object-cover shadow-inner backdrop-blur-sm">
                                <i
                                    class="fa-solid fa-camera text-2xl text-white/50 group-hover:text-white transition"></i>
                            </div>
                            <div
                                class="absolute bottom-1 right-1 bg-blue-500 w-8 h-8 rounded-full flex items-center justify-center border-2 border-[#1c1c1e] shadow-lg">
                                <i class="fa-solid fa-plus text-white text-xs"></i>
                            </div>
                        </div>
                        <p class="text-zinc-400 text-xs mt-3 font-medium">Add Profile Photo</p>
                        <input type="file" id="reg-photo-input" accept="image/*" class="hidden"
                            onchange="previewRegPhoto(this)">
                    </div>

                    <div class="space-y-4">
                        <div class="group">
                            <label
                                class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block tracking-wider">Email
                                Address</label>
                            <input type="email" id="auth-email"
                                class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50 focus:bg-black/50 transition placeholder-zinc-600 backdrop-blur-sm"
                                placeholder="">
                        </div>
                        <div class="group">
                            <label
                                class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block tracking-wider">Password</label>
                            <input type="password" id="auth-password"
                                class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50 focus:bg-black/50 transition placeholder-zinc-600 backdrop-blur-sm"
                                placeholder="">
                        </div>
                    </div>

                    <div id="register-fields" class="hidden space-y-4 pt-4 border-t border-white/10 mt-2">

                        <div class="flex gap-3">
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">First
                                    Name</label>
                                <input type="text" id="reg-firstname"
                                    class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50"
                                    placeholder="">
                            </div>
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Last
                                    Name</label>
                                <input type="text" id="reg-lastname"
                                    class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50"
                                    placeholder="">
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Age</label>
                                <input type="number" id="reg-age"
                                    class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50"
                                    placeholder="">
                            </div>
                            <div class="flex-1">
                                <label
                                    class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Blood</label>
                                <div class="relative">
                                    <select id="reg-blood"
                                        class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none appearance-none focus:border-blue-500/50">
                                        <option value="Unknown" class="bg-zinc-900">Select</option>
                                        <option value="A+" class="bg-zinc-900">A+</option>
                                        <option value="O+" class="bg-zinc-900">O+</option>
                                        <option value="B+" class="bg-zinc-900">B+</option>
                                        <option value="AB+" class="bg-zinc-900">AB+</option>
                                        <option value="A-" class="bg-zinc-900">A-</option>
                                        <option value="O-" class="bg-zinc-900">O-</option>
                                    </select>
                                    <i
                                        class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-xs text-zinc-500 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Dietary
                                Goal</label>
                            <div class="relative">
                                <select id="reg-goal"
                                    class="w-full bg-black/30 text-white p-4 rounded-2xl border border-white/5 outline-none appearance-none focus:border-blue-500/50">
                                    <option value="Maintain" class="bg-zinc-900">Maintain Weight</option>
                                    <option value="Weight Loss" class="bg-zinc-900">Weight Loss</option>
                                    <option value="Aggressive Weight Loss" class="bg-zinc-900">Aggressive Weight Loss
                                    </option>
                                    <option value="Weight Gain" class="bg-zinc-900">Weight Gain</option>
                                    <option value="Aggressive Weight Gain" class="bg-zinc-900">Aggressive Weight Gain
                                    </option>
                                </select>
                                <div
                                    class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-zinc-500">
                                    <i class="fa-solid fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label
                                class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Location</label>
                            <div class="relative flex items-center">
                                <input type="text" id="reg-location"
                                    class="w-full bg-black/30 text-white p-4 pr-12 rounded-2xl border border-white/5 outline-none focus:border-blue-500/50"
                                    placeholder="Detecting..." readonly>
                                <button onclick="detectUserLocation()"
                                    class="absolute right-2 top-2 bottom-2 bg-white/10 hover:bg-white/20 text-blue-400 w-10 rounded-xl flex items-center justify-center transition-all border border-white/5 shadow-sm active:scale-90">
                                    <i class="fa-solid fa-location-crosshairs"></i>
                                </button>
                            </div>
                        </div>

                        <div class="relative">
                            <label class="text-[10px] font-bold text-zinc-400 uppercase ml-3 mb-1 block">Chronic
                                Conditions</label>
                            <div class="w-full bg-black/30 min-h-[60px] p-2 rounded-2xl border border-white/5 focus-within:border-blue-500/50 transition flex flex-wrap gap-2 cursor-text"
                                onclick="document.getElementById('condition-search').focus()">
                                <div id="conditions-container" class="contents"></div>
                                <input type="text" id="condition-search"
                                    class="bg-transparent text-white outline-none flex-1 min-w-[100px] p-2 placeholder-zinc-600 text-sm"
                                    placeholder="Search..." autocomplete="off">
                            </div>
                            <div id="suggestions-box"
                                class="hidden absolute top-full left-0 w-full bg-[#1c1c1e] border border-white/10 rounded-xl mt-2 overflow-hidden shadow-2xl max-h-40 overflow-y-auto z-[101]">
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 pb-2">
                        <button onclick="handleAuth()" id="auth-action-btn"
                            class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-900/20 active:scale-95 transition-all text-lg tracking-wide">
                            Log In
                        </button>
                        <button onclick="bypassAuth()"
                            class="w-full mt-4 py-2 text-zinc-500 text-xs font-bold hover:text-white transition uppercase tracking-widest opacity-60 hover:opacity-100">
                            Continue as Guest
                        </button>
                        <p id="auth-error" class="text-red-400 text-xs text-center font-bold mt-3 h-4"></p>
                    </div>
                </div>
            </div>

            <div class="h-10 w-full"></div>
        </div>
    </div>
    </div>
    </div>
    <div id="google-places-service" style="display:none;"></div>
    <button onclick="toggleProfile(true)"
        class="absolute top-6 right-6 z-50 w-14 h-14 bg-zinc-800 rounded-full shadow-xl flex items-center justify-center active:scale-90 transition-transform border border-zinc-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
    </button>



    <div id="dynamic-island"
        class="absolute top-6 left-1/2 -translate-x-1/2 z-50 bg-black shadow-2xl ios-spring overflow-hidden cursor-pointer group"
        style="width: 200px; height: 64px; border-radius: 9999px;" onclick="expandCamera()">

        <div id="camera-icon" class="absolute inset-0 flex items-center justify-center transition-opacity duration-250">
            <svg xmlns="http://www.w3.org/2000/svg"
                class="h-8 w-8 text-white group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </div>

        <div id="camera-view"
            class="absolute inset-0 opacity-0 pointer-events-none transition-opacity duration-500 delay-100 flex flex-col">

            <div class="absolute top-4 right-4 z-20 bg-black/50 rounded-full p-2 backdrop-blur-md"
                onclick="collapseCamera(event)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </div>

            <video id="camera-stream" autoplay playsinline class="w-full h-full object-cover"></video>

            <div class="absolute bottom-6 w-full text-center">
                <p
                    class="text-white font-medium text-sm bg-black/30 backdrop-blur-md inline-block px-4 py-1 rounded-full border border-white/20">
                    Scanning
                </p>
            </div>
        </div>
    </div>

    <input type="file" id="camera-input" accept="image/*" capture="environment" class="hidden">

    <div id="home-screen" class="flex-1 flex flex-col p-6 space-y-6 overflow-y-auto no-scrollbar pb-32">
        <h1 class="text-3xl font-extrabold mt-20 tracking-tight">
            <span id="greeting-text">Good Evening,</span><br>
            <span id="greeting-name" class="text-zinc-400">Guest</span>
        </h1>
        <div class="grid grid-cols-2 gap-4 h-56">
            <div
                class="animated-gradient-1 rounded-3xl p-5 flex flex-col justify-between shadow-lg relative overflow-hidden">
                <i class="fa-solid fa-bolt absolute top-5 right-5 text-2xl opacity-70"></i>
                <div></div>
                <h2 class="text-2xl font-bold relative z-10 leading-tight">Quick<br>Actions</h2>
            </div>
            <div id="care-card" onclick="openMapModal()"
                class="relative rounded-3xl overflow-hidden shadow-lg border border-zinc-800 bg-zinc-900 h-56 cursor-pointer active:scale-95 transition-transform duration-300 group">

                <div id="static-map-preview"
                    class="absolute inset-0 z-0 opacity-60 grayscale group-hover:grayscale-0 transition-all duration-500">
                </div>

                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent z-10"></div>

                <div class="relative z-20 h-full p-5 flex flex-col justify-between">
                    <div></div>
                    <div class="flex flex-col">
                        <h2 class="text-white font-bold text-2xl leading-tight tracking-tight">Care &<br>Connect</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-zinc-900 rounded-3xl p-6 h-48 relative overflow-hidden border border-zinc-800 flex items-center">
            <div class="max-w-[65%] z-10">
                <h3 class="font-bold text-xl mb-2 text-white"><i class="fa-solid fa-paw mr-2"></i>Dr. Paws Tip</h3>
                <p class="text-zinc-400 leading-relaxed">"Bamboo is great, but variety is better! Try adding colorful
                    veggies to your next meal."</p>
            </div>
            <img src="https://cdn-icons-png.flaticon.com/512/3769/3769036.png"
                class="absolute -right-6 -bottom-10 w-48 opacity-90 rotate-12 drop-shadow-2xl" alt="Mascot Peeking">
        </div>
    </div>
    <div id="profile-modal"
        class="hidden fixed inset-0 z-[200] bg-black transition-transform duration-300 translate-x-full overflow-y-auto no-scrollbar">

        <div class="min-h-full flex flex-col relative">

            <div
                class="px-6 pt-12 pb-4 flex justify-between items-center sticky top-0 bg-black/90 backdrop-blur-md z-50 border-b border-white/10">
                <button onclick="toggleProfile(false)"
                    class="w-10 h-10 bg-zinc-800 rounded-full flex items-center justify-center active:scale-90 transition-transform border border-zinc-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18L9 12L15 6"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-extrabold text-white tracking-tight">Medical ID</h1>
                <button onclick="saveAndCloseProfile()" class="text-blue-500 font-bold text-lg">Done</button>
            </div>

            <div class="p-6 pb-40 flex flex-col items-center">

                <div class="relative group cursor-pointer mb-8">
                    <div
                        class="w-28 h-28 rounded-full bg-zinc-800 border-4 border-[#1c1c1e] overflow-hidden flex items-center justify-center shadow-2xl relative">
                        <img id="profile-img-display" class="w-full h-full object-cover hidden" src="" />
                        <i id="profile-icon-display"
                            class="fa-solid fa-user text-4xl text-zinc-500 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></i>
                    </div>
                    <div
                        class="absolute bottom-1 right-1 bg-blue-600 w-8 h-8 rounded-full flex items-center justify-center border-2 border-black shadow-lg">
                        <i class="fa-solid fa-camera text-xs text-white"></i>
                    </div>
                </div>

                <div class="w-full space-y-6">

                    <div>
                        <h3 class="text-zinc-500 text-xs font-bold uppercase ml-4 mb-2">Basic Info</h3>
                        <div class="bg-[#1c1c1e] rounded-2xl overflow-hidden border border-white/5">
                            <div class="flex items-center justify-between p-4 border-b border-zinc-800">
                                <span class="text-white font-medium">Name</span>
                                <input type="text" id="p-name" placeholder="Your Name"
                                    class="bg-transparent text-right text-zinc-400 outline-none w-1/2 focus:text-blue-500">
                            </div>
                            <div class="flex border-b border-zinc-800">
                                <div class="flex-1 flex items-center justify-between p-4 border-r border-zinc-800">
                                    <span class="text-white font-medium">Age</span>
                                    <input type="number" id="p-age" placeholder="--"
                                        class="bg-transparent text-right text-zinc-400 outline-none w-12 focus:text-blue-500">
                                </div>
                                <div class="flex-1 flex items-center justify-between p-4">
                                    <span class="text-white font-medium">Blood</span>
                                    <select id="p-blood"
                                        class="bg-transparent text-right text-zinc-400 outline-none appearance-none focus:text-blue-500">
                                        <option value="Unknown">--</option>
                                        <option value="A+">A+</option>
                                        <option value="O+">O+</option>
                                        <option value="B+">B+</option>
                                        <option value="AB+">AB+</option>
                                        <option value="A-">A-</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-4 border-b border-zinc-800">
                                <span class="text-white font-medium">Height (cm)</span>
                                <input type="number" id="p-height" placeholder="--"
                                    class="bg-transparent text-right text-zinc-400 outline-none w-20 focus:text-blue-500">
                            </div>
                            <div class="flex items-center justify-between p-4">
                                <span class="text-white font-medium">Weight (kg)</span>
                                <input type="number" id="p-weight" placeholder="--"
                                    class="bg-transparent text-right text-zinc-400 outline-none w-20 focus:text-blue-500">
                            </div>
                        </div>
                    </div>

                    <div class="relative group">
                        <h3 class="text-zinc-500 text-xs font-bold uppercase ml-4 mb-2">Health Conditions</h3>

                        <div
                            class="bg-[#1c1c1e] p-4 rounded-2xl border border-white/5 flex flex-col gap-3 relative z-50">

                            <div class="relative w-full">
                                <div class="flex items-center gap-3 border-b border-white/10 pb-2">
                                    <i class="fa-solid fa-magnifying-glass text-zinc-500"></i>

                                    <input type="text" id="p-condition-search"
                                        class="flex-1 bg-transparent text-white placeholder-zinc-600 outline-none text-sm h-8"
                                        placeholder="Type condition (e.g. Diabetes)..." autocomplete="off">

                                    <button onclick="document.getElementById('p-condition-search').focus()"
                                        class="bg-blue-600 hover:bg-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform shrink-0">
                                        <i class="fa-solid fa-plus text-sm"></i>
                                    </button>
                                </div>

                                <div id="p-suggestions-box"
                                    class="hidden absolute top-full left-0 w-full bg-[#2c2c2e] border border-white/20 rounded-b-xl shadow-2xl max-h-60 overflow-y-auto z-[999] mt-1">
                                </div>
                            </div>

                            <div id="p-conditions-container" class="flex flex-wrap gap-2 min-h-[10px]"></div>
                        </div>

                        <p class="text-[10px] text-zinc-600 ml-4 mt-1">Specific conditions help Dr. Paws give accurate
                            safety warnings.</p>
                    </div>

                    <div>
                        <h3 class="text-zinc-500 text-xs font-bold uppercase ml-4 mb-2">Active Medications</h3>
                        <div class="bg-[#1c1c1e] rounded-2xl p-4 border border-white/5">
                            <textarea id="p-meds" rows="3"
                                class="w-full bg-transparent text-white placeholder-zinc-600 outline-none resize-none leading-relaxed"
                                placeholder="Ex: Metformin (Morning), Insulin (Night)..."></textarea>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-zinc-500 text-xs font-bold uppercase ml-4 mb-2">Goals & Location</h3>
                        <div class="bg-[#1c1c1e] rounded-2xl overflow-hidden border border-white/5">
                            <div class="flex items-center justify-between p-4 border-b border-zinc-800">
                                <span class="text-white font-medium">Dietary Goal</span>
                                <input type="text" id="p-goal" placeholder="Lose weight / Gain muscle"
                                    class="bg-transparent text-right text-zinc-400 outline-none w-1/2 focus:text-blue-500">
                            </div>
                            <div class="flex items-center justify-between p-4">
                                <span class="text-white font-medium">Location</span>
                                <input type="text" id="p-location" placeholder="City, Country"
                                    class="bg-transparent text-right text-zinc-400 outline-none w-1/2 focus:text-blue-500">
                            </div>
                        </div>
                    </div>

                    <div class="pt-8 border-t border-zinc-800 mt-4">
                        <button onclick="logout()"
                            class="w-full py-4 bg-[#1c1c1e] border border-zinc-800 text-red-500 font-bold rounded-2xl flex items-center justify-center gap-2 active:scale-95 transition-all group hover:bg-red-900/10 hover:border-red-900/30">
                            <i
                                class="fa-solid fa-right-from-bracket group-hover:-translate-x-1 transition-transform"></i>
                            Log Out
                        </button>
                        <p class="text-center text-zinc-600 text-[10px] mt-6 px-8 leading-relaxed">MediPanda v1.0 â€¢
                            Secure Session</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div id="chat-screen" class="hidden flex-1 flex flex-col bg-zinc-950">
        <div id="chat-container" class="flex-1 overflow-y-auto p-4 pb-32 space-y-4">
            <div class="flex justify-start">
                <div
                    class="bg-zinc-800 text-gray-200 p-3 rounded-2xl rounded-tl-none max-w-[80%] border border-zinc-700 shadow-sm text-sm">
                    Hello! I'm Dr. Paws. Ask me anything!
                </div>
            </div>
        </div>
        <div class="w-full bg-zinc-900 border-t border-zinc-800 p-4 pb-28">
            <div class="flex items-center gap-3">

                <button onclick="document.getElementById('camera-input').click()"
                    class="text-zinc-400 hover:text-white transition">
                    <i class="fa-solid fa-camera"></i>
                </button>

                <input type="text" id="user-input"
                    class="flex-1 bg-zinc-800 text-white rounded-full px-5 py-3 outline-none border border-zinc-700 focus:border-blue-500 transition placeholder-zinc-500"
                    placeholder="Ask Dr. Paws..." onkeypress="if(event.key === 'Enter') sendMessage()">

                <button onclick="sendMessage()"
                    class="bg-blue-600 text-white w-12 h-12 rounded-full hover:bg-blue-500 transition shadow-lg active:scale-90 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // --- 1. CONFIGURATION & SAFETY GLOBALS ---
        mapboxgl.accessToken = 'pk.eyJ1Ijoic2lkZGhhbnRiYW5zb2QiLCJhIjoiY21raWJ5amo2MHI3cjNlcXhwY2RmZHlhNiJ9.AmRwXlI_MuxXn7x2PR7IAg';

        let mapInstance = null;
        let markers = [];
        let userLat = 19.0330;
        let userLng = 73.0297;
        let currentUser = null; // Holds the logged-in user (or guest)

        // --- 2. AUTHENTICATION & REGISTRATION LOGIC ---
        //localStorage.removeItem('paws_guest_profile'); location.reload();
        // Global Variables
        let authMode = 'login';
        let uploadedPhotoBase64 = null; // To store the image string

        window.addEventListener('load', () => {
            initPreview();
            updateHomeGreeting();
            // Check for saved user (Guest or Supabase)
            const guestData = localStorage.getItem('paws_guest_profile');
            if (guestData) {
                currentUser = { isGuest: true, data: JSON.parse(guestData) };
                // Auto-load profile picture if exists
                if (currentUser.data.photo) updateProfilePhotoUI(currentUser.data.photo);
                // Hide auth screen
                document.getElementById('auth-screen').classList.add('hidden');
                updateUIWithProfile(currentUser.data);
            }
        });

        // A. Toggle between Simple Login and Big Register Form
        function toggleAuthMode(mode) {
            authMode = mode;
            const btn = document.getElementById('auth-action-btn');
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');
            const regFields = document.getElementById('register-fields');
            const regAvatar = document.getElementById('register-avatar');

            if (mode === 'login') {
                btn.innerText = "Log In";
                tabLogin.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-zinc-600 text-white transition-all";
                tabRegister.className = "flex-1 py-2 text-sm font-bold rounded-lg text-zinc-400 hover:text-white transition-all";
                regFields.classList.add('hidden');
                regAvatar.classList.add('hidden');
            } else {
                btn.innerText = "Create Profile";
                tabRegister.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-zinc-600 text-white transition-all";
                tabLogin.className = "flex-1 py-2 text-sm font-bold rounded-lg text-zinc-400 hover:text-white transition-all";
                regFields.classList.remove('hidden');
                regAvatar.classList.remove('hidden'); // Show photo uploader
                regAvatar.classList.add('flex');
            }
        }

        // B. Handle Photo Preview (Converts to Base64)
        function previewRegPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    uploadedPhotoBase64 = e.target.result; // Save string
                    const previewDiv = document.getElementById('reg-photo-preview');
                    previewDiv.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // C. Update Profile Photo Everywhere
        function updateProfilePhotoUI(base64String) {
            if (!base64String) return;

            // 1. Home Screen Profile Button
            const homeBtn = document.querySelector('button[onclick="showScreen(\'profile\')"]');
            if (homeBtn) {
                homeBtn.innerHTML = `<img src="${base64String}" class="w-full h-full object-cover rounded-full border border-zinc-600">`;
            }

            // 2. Profile Screen Large Avatar
            const profileAvatar = document.querySelector('#profile-screen .w-24.h-24'); // Target the big circle
            if (profileAvatar) {
                profileAvatar.innerHTML = `<img src="${base64String}" class="w-full h-full object-cover">`;
                profileAvatar.classList.remove('bg-zinc-800'); // Remove gray background
            }
        }

        // D. Main Handle Auth (Login OR Register)
        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorMsg = document.getElementById('auth-error');
            const btn = document.getElementById('auth-action-btn');

            errorMsg.innerText = "";

            // 1. LOGIN MODE
            if (authMode === 'login') {
                if (!email || !password) { errorMsg.innerText = "Please enter email & password."; return; }
                // For demo, we just simulate login or bypass
                bypassAuth();
                return;
            }

            // 2. REGISTER MODE (The Big Save)
            if (authMode === 'register') {
                const fname = document.getElementById('reg-firstname').value.trim();
                const lname = document.getElementById('reg-lastname').value.trim();

                if (!fname || !lname) {
                    errorMsg.innerText = "First and Last Name are required.";
                    return;
                }

                btn.innerText = "Creating Profile...";

                // Combine Names
                const fullName = `${fname} ${lname}`;

                const newProfile = {
                    id: "user_" + Math.random().toString(36).substr(2, 9),
                    email: email,
                    full_name: fullName, // Saved as one string for display
                    first_name: fname,   // Saved separately for logic
                    last_name: lname,
                    age: document.getElementById('reg-age').value,
                    blood_group: document.getElementById('reg-blood').value,
                    conditions: selectedConditions.join(", "),
                    // Meds are optional, no check needed
                    medications: document.getElementById('reg-meds') ? document.getElementById('reg-meds').value : "",
                    dietary_goal: document.getElementById('reg-goal').value, // Gets value from dropdown
                    location: document.getElementById('reg-location').value,
                    photo: uploadedPhotoBase64,
                    joined_at: new Date()
                };

                // SAVE DATA (Simulate Database Insert)
                try {
                    // A. Save to Local Storage (Guest DB)
                    localStorage.setItem('paws_guest_profile', JSON.stringify(newProfile));

                    // B. If Supabase was active, we would run: 
                    // await supabase.from('profiles').insert([newProfile]);

                    // C. Update App State
                    currentUser = { isGuest: true, data: newProfile };
                    updateUIWithProfile(newProfile); // Update text fields
                    updateProfilePhotoUI(newProfile.photo); // Update images

                    // D. Success Transition
                    setTimeout(() => {
                        document.getElementById('auth-screen').classList.add('hidden');
                        alert("Welcome, " + newProfile.full_name + "!");
                    }, 800);

                } catch (e) {
                    errorMsg.innerText = "Error saving profile. Try again.";
                    btn.innerText = "Create Profile";
                }
            }
        }

        // E. Update UI Text Fields (Helper)
        // --- FIXED UPDATE UI FUNCTION ---
        function updateUIWithProfile(data) {
            // 1. Basic Fields
            if (data.full_name) {
                document.getElementById('p-name').value = data.full_name;
                // Also update the Home Screen Header
                const headerName = document.querySelector('h1 span');
                if (headerName) headerName.innerText = data.full_name.split(' ')[0];
                // Also update the Greeting
                updateHomeGreeting();
            }

            // Safely update fields only if they exist
            if (document.getElementById('p-age')) document.getElementById('p-age').value = data.age || '';
            if (document.getElementById('p-blood')) document.getElementById('p-blood').value = data.blood_group || 'Unknown';
            if (document.getElementById('p-meds')) document.getElementById('p-meds').value = data.medications || '';
            if (document.getElementById('p-goal')) document.getElementById('p-goal').value = data.dietary_goal || '';
            if (document.getElementById('p-location')) document.getElementById('p-location').value = data.location || '';

            // 2. CRITICAL FIX: Handle Conditions (Tags vs Textbox)
            // The old code tried: document.getElementById('p-conditions').value = ... (CRASHES)

            // New Logic: Populate the Tags Array
            if (data.conditions && data.conditions.trim() !== "") {
                // Split string "Diabetes, Asthma" -> Array ["Diabetes", "Asthma"]
                profileSelectedConditions = data.conditions.split(', ').filter(i => i);
            } else {
                profileSelectedConditions = [];
            }

            // 3. Render the tags immediately
            renderProfileTags();
        }
        // Keep existing bypassAuth for the "Guest" button
        function bypassAuth() {
            currentUser = { id: "guest", isGuest: true };
            document.getElementById('auth-screen').classList.add('hidden');

            // Attempt to load existing data
            const savedData = localStorage.getItem('paws_guest_profile');
            if (savedData) {
                const data = JSON.parse(savedData);
                updateUIWithProfile(data);
                if (data.photo) updateProfilePhotoUI(data.photo);
            }
        }
        // --- LOCATION DETECTION LOGIC ---
        async function detectUserLocation() {
            const locInput = document.getElementById('reg-location');
            const icon = event.currentTarget.querySelector('i');

            // Visual Feedback
            locInput.value = "Locating...";
            icon.className = "fa-solid fa-spinner fa-spin";

            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser");
                locInput.value = "";
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;

                // Use Mapbox Reverse Geocoding to get City Name
                const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?types=place&access_token=${mapboxgl.accessToken}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        // Found the city!
                        locInput.value = data.features[0].text;
                    } else {
                        // Fallback if Mapbox fails to find city name
                        locInput.value = `${lat.toFixed(2)}, ${lng.toFixed(2)}`;
                    }
                } catch (e) {
                    console.error(e);
                    locInput.value = "Unknown Location";
                }

                // Reset Icon
                icon.className = "fa-solid fa-location-crosshairs";

            }, () => {
                alert("Unable to retrieve your location. Please type it manually.");
                locInput.value = "";
                locInput.readOnly = false; // Let user type if GPS fails
                icon.className = "fa-solid fa-location-crosshairs";
            });
        }
        // --- MEDICAL CONDITION TAGGING SYSTEM (Fixed) ---

        // --- 1. EXPANDED MEDICAL DATABASE (Professional Grade) ---
        const MASTER_CONDITIONS = [
            // Metabolic & Endocrine
            "Type 1 Diabetes Mellitus", "Type 2 Diabetes Mellitus", "Gestational Diabetes",
            "Prediabetes", "Hypothyroidism (Hashimoto's)", "Hyperthyroidism (Graves' Disease)",
            "PCOS (Polycystic Ovary Syndrome)", "Addison's Disease", "Cushing's Syndrome",
            "Obesity (Class I)", "Obesity (Class II)", "Obesity (Class III)",

            // Cardiovascular (Heart)
            "Hypertension (Chronic High BP)", "Coronary Artery Disease (CAD)",
            "Atrial Fibrillation (A-Fib)", "Congestive Heart Failure (CHF)",
            "History of Myocardial Infarction (Heart Attack)", "Dilated Cardiomyopathy",
            "Hypertrophic Cardiomyopathy", "Aortic Valve Stenosis", "Mitral Valve Prolapse",
            "Peripheral Artery Disease (PAD)", "Deep Vein Thrombosis (DVT)",

            // Respiratory (Lungs)
            "Asthma (Mild Intermittent)", "Asthma (Severe Persistent)",
            "COPD (Chronic Obstructive Pulmonary Disease)", "Pulmonary Fibrosis",
            "Sleep Apnea (Obstructive)", "Sleep Apnea (Central)", "Cystic Fibrosis",
            "Pulmonary Hypertension",

            // Oncology (Cancers - Specific)
            "Breast Cancer (In Remission)", "Breast Cancer (Active Treatment)",
            "Prostate Cancer", "Lung Cancer (Non-Small Cell)", "Lung Cancer (Small Cell)",
            "Colorectal Cancer", "Melanoma", "Basal Cell Carcinoma",
            "Leukemia (ALL)", "Leukemia (AML)", "Leukemia (CLL)", "Leukemia (CML)",
            "Hodgkin Lymphoma", "Non-Hodgkin Lymphoma", "Pancreatic Cancer",
            "Ovarian Cancer", "Liver Cancer (Hepatocellular Carcinoma)", "Glioblastoma",

            // Kidney (Renal)
            "Chronic Kidney Disease (Stage 1-2)", "Chronic Kidney Disease (Stage 3a/3b)",
            "Chronic Kidney Disease (Stage 4)", "End-Stage Renal Disease (ESRD)",
            "Polycystic Kidney Disease (PKD)", "Recurrent Kidney Stones", "Glomerulonephritis",

            // Liver & Pancreas
            "Liver Cirrhosis (Compensated)", "Liver Cirrhosis (Decompensated)",
            "Non-Alcoholic Fatty Liver Disease (NAFLD)", "NASH",
            "Chronic Hepatitis B", "Chronic Hepatitis C", "Autoimmune Hepatitis",
            "Chronic Pancreatitis", "Hemochromatosis",

            // Neurological
            "Epilepsy / Seizure Disorder", "Migraine (Chronic)", "Alzheimer's Disease",
            "Parkinson's Disease", "Multiple Sclerosis (MS)", "Myasthenia Gravis",
            "Peripheral Neuropathy", "Stroke History (Ischemic)", "Stroke History (Hemorrhagic)",

            // Autoimmune & Musculoskeletal
            "Rheumatoid Arthritis", "Osteoarthritis", "Systemic Lupus Erythematosus (SLE)",
            "Psoriatic Arthritis", "Ankylosing Spondylitis", "Sjogren's Syndrome",
            "Gout (Chronic)", "Osteoporosis", "Fibromyalgia",

            // Gastrointestinal
            "Celiac Disease", "Crohn's Disease", "Ulcerative Colitis",
            "IBS (Irritable Bowel Syndrome)", "GERD (Chronic Reflux)", "Barrett's Esophagus",

            // Hereditary / Genetic
            "Sickle Cell Anemia", "Thalassemia Major", "Thalassemia Minor",
            "Hemophilia A", "Hemophilia B", "Von Willebrand Disease",
            "Huntington's Disease", "Marfan Syndrome", "Ehlers-Danlos Syndrome",
            "Lynch Syndrome", "BRCA1 Mutation", "BRCA2 Mutation",

            // Allergies (Severe)
            "Peanut Allergy (Anaphylactic)", "Shellfish Allergy", "Tree Nut Allergy",
            "Egg Allergy", "Dairy Allergy", "Soy Allergy", "Wheat Allergy",
            "Penicillin Allergy", "Sulfa Drug Allergy", "Latex Allergy"
        ];

        let selectedConditions = [];

        // Re-attach listeners whenever we switch to Register mode
        function attachConditionListeners() {
            const input = document.getElementById('condition-search');
            const suggestionBox = document.getElementById('suggestions-box');

            if (!input || !suggestionBox) return;

            // Clear old listeners to avoid duplicates (clone node trick)
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);

            // Attach 'Input' Event
            newInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();

                if (query.length < 1) {
                    suggestionBox.classList.add('hidden');
                    return;
                }

                const matches = MASTER_CONDITIONS.filter(c =>
                    c.toLowerCase().includes(query) && !selectedConditions.includes(c)
                );

                if (matches.length > 0) {
                    suggestionBox.innerHTML = matches.map(c => `
                <div onclick="addConditionTag('${c}')" 
                     class="p-3 hover:bg-zinc-700 text-white cursor-pointer border-b border-zinc-700/50 last:border-0 transition text-sm font-medium">
                    ${c}
                </div>
            `).join('');
                    suggestionBox.classList.remove('hidden');
                } else {
                    suggestionBox.classList.add('hidden');
                }
            });

            // Re-focus helper
            newInput.addEventListener('blur', () => {
                // Delay hiding so clicks register
                setTimeout(() => suggestionBox.classList.add('hidden'), 200);
            });
        }

        // Add Tag
        function addConditionTag(condition) {
            if (selectedConditions.includes(condition)) return;
            selectedConditions.push(condition);
            renderTags();

            const input = document.getElementById('condition-search');
            input.value = "";
            document.getElementById('suggestions-box').classList.add('hidden');
            input.focus();
        }

        // Remove Tag
        function removeConditionTag(condition) {
            selectedConditions = selectedConditions.filter(c => c !== condition);
            renderTags();
        }

        // Render Blue Chips
        function renderTags() {
            const container = document.getElementById('conditions-container');
            container.innerHTML = selectedConditions.map(c => `
        <div class="bg-blue-600/20 border border-blue-500/50 text-blue-400 px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm font-medium animate-fade-in">
            <span>${c}</span>
            <button onclick="removeConditionTag('${c}')" class="hover:text-white transition">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    `).join('');
        }

        // --- UPDATE TOGGLE FUNCTION ---
        // Update your existing toggleAuthMode function to call attachConditionListeners()
        const originalToggle = toggleAuthMode; // Store old ref if needed, or just overwrite:

        function toggleAuthMode(mode) {
            authMode = mode;
            const btn = document.getElementById('auth-action-btn');
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');
            const regFields = document.getElementById('register-fields');
            const regAvatar = document.getElementById('register-avatar');

            if (mode === 'login') {
                btn.innerText = "Log In";
                tabLogin.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-zinc-600 text-white transition-all";
                tabRegister.className = "flex-1 py-2 text-sm font-bold rounded-lg text-zinc-400 hover:text-white transition-all";
                regFields.classList.add('hidden');
                regAvatar.classList.add('hidden');
            } else {
                btn.innerText = "Create Profile";
                tabRegister.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-zinc-600 text-white transition-all";
                tabLogin.className = "flex-1 py-2 text-sm font-bold rounded-lg text-zinc-400 hover:text-white transition-all";
                regFields.classList.remove('hidden');
                regAvatar.classList.remove('hidden');
                regAvatar.classList.add('flex');

                // CRITICAL: Activate the search box now that it is visible
                setTimeout(attachConditionListeners, 100);
            }
        }

        // --- 3. PREVIEW MAP (Small Static Image) ---
        function initPreview() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((p) => {
                    userLat = p.coords.latitude;
                    userLng = p.coords.longitude;
                    const staticUrl = `https://api.mapbox.com/styles/v1/mapbox/dark-v11/static/${userLng},${userLat},13,0/600x400?access_token=${mapboxgl.accessToken}`;
                    const previewDiv = document.getElementById('static-map-preview');
                    if (previewDiv) {
                        previewDiv.style.backgroundImage = `url('${staticUrl}')`;
                        previewDiv.style.backgroundSize = 'cover';
                        previewDiv.style.opacity = '0.8';
                    }
                });
            }
        }

        // --- 4. ANIMATIONS (Fixed Visibility Bug) ---
        function openMapModal() {
            const card = document.getElementById('care-card');
            const modal = document.getElementById('map-modal');
            const content = document.getElementById('modal-content');
            const rect = card.getBoundingClientRect();

            modal.style.visibility = 'visible'; // CRITICAL FIX
            modal.style.transition = 'none';
            modal.style.top = `${rect.top}px`;
            modal.style.left = `${rect.left}px`;
            modal.style.width = `${rect.width}px`;
            modal.style.height = `${rect.height}px`;
            modal.style.borderRadius = '24px';
            modal.style.opacity = '1';
            modal.style.pointerEvents = 'none';

            modal.offsetHeight; // Force Paint

            modal.style.transition = '';
            requestAnimationFrame(() => {
                modal.style.top = '0px';
                modal.style.left = '0px';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.borderRadius = '0px';
            });

            content.classList.remove('content-hidden');
            content.classList.add('content-visible');

            setTimeout(() => {
                modal.style.pointerEvents = 'auto'; // Unlock Interaction
                initFullMap();
            }, 500);
        }

        function closeMapModal() {
            const card = document.getElementById('care-card');
            const modal = document.getElementById('map-modal');
            const content = document.getElementById('modal-content');
            const rect = card.getBoundingClientRect();

            content.classList.remove('content-visible');
            content.classList.add('content-hidden');

            modal.style.pointerEvents = 'none';
            modal.style.top = `${rect.top}px`;
            modal.style.left = `${rect.left}px`;
            modal.style.width = `${rect.width}px`;
            modal.style.height = `${rect.height}px`;
            modal.style.borderRadius = '24px';

            setTimeout(() => {
                modal.style.opacity = '0';
                modal.style.visibility = 'hidden'; // CRITICAL FIX
            }, 500);
        }

        // --- 5. MAP BUILDER ---
        function initFullMap() {
            if (mapInstance) {
                mapInstance.resize();
                return;
            }
            setTimeout(() => {
                mapInstance = new mapboxgl.Map({
                    container: 'full-map',
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: [userLng, userLat],
                    zoom: 14,
                    pitch: 45,
                    attributionControl: false
                });

                const el = document.createElement('div');
                el.className = 'user-marker';
                el.style.width = '20px';
                el.style.height = '20px';
                el.style.backgroundColor = '#3b82f6';
                el.style.borderRadius = '50%';
                el.style.border = '3px solid white';
                el.style.boxShadow = '0 0 20px #3b82f6';
                new mapboxgl.Marker(el).setLngLat([userLng, userLat]).addTo(mapInstance);

                mapInstance.on('load', () => {
                    mapInstance.resize();
                    const layers = mapInstance.getStyle().layers;
                    const labelLayerId = layers.find(l => l.type === 'symbol' && l.layout['text-field']).id;
                    mapInstance.addLayer({
                        'id': 'add-3d-buildings',
                        'source': 'composite',
                        'source-layer': 'building',
                        'filter': ['==', 'extrude', 'true'],
                        'type': 'fill-extrusion',
                        'minzoom': 15,
                        'paint': {
                            'fill-extrusion-color': '#222',
                            'fill-extrusion-height': ['get', 'height'],
                            'fill-extrusion-base': ['get', 'min_height'],
                            'fill-extrusion-opacity': 0.8
                        }
                    }, labelLayerId);
                });
            }, 100);
        }

        // --- 6. SEARCH LOGIC ---
        async function searchNearby(category) {
            if (!mapInstance) return;
            const btn = event.currentTarget;
            const originalContent = btn.innerHTML;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin text-white"></i>`;

            if (markers) markers.forEach(m => m.remove());
            markers = [];

            const searchTerm = category === 'hospital' ? 'hospital, clinic' : category;
            const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${searchTerm}.json?proximity=${userLng},${userLat}&types=poi&limit=10&access_token=${mapboxgl.accessToken}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.features && data.features.length > 0) {
                    const bounds = new mapboxgl.LngLatBounds();
                    data.features.forEach((place) => {
                        const el = document.createElement('div');
                        const colorClass = category === 'hospital' ? 'bg-red-500' : 'bg-blue-500';
                        el.className = `w-4 h-4 rounded-full border-2 border-white shadow-lg ${colorClass}`;
                        const popup = new mapboxgl.Popup({ offset: 25, closeButton: false })
                            .setHTML(`<b style="color:black">${place.text}</b><br><span style="color:#555;font-size:10px">${place.properties?.address || ''}</span>`);
                        const marker = new mapboxgl.Marker(el)
                            .setLngLat(place.center)
                            .setPopup(popup)
                            .addTo(mapInstance);
                        markers.push(marker);
                        bounds.extend(place.center);
                    });
                    mapInstance.fitBounds(bounds, { padding: 80, maxZoom: 15 });
                    addMessage(`Found ${data.features.length} ${category}s nearby.`, false);
                } else {
                    loadUlweBackups(category);
                }
            } catch (error) {
                loadUlweBackups(category);
            }
            btn.innerHTML = originalContent;
        }
        // --- DYNAMIC GREETING LOGIC ---
        function updateHomeGreeting() {
            const textEl = document.getElementById('greeting-text');
            const nameEl = document.getElementById('greeting-name');

            if (!textEl || !nameEl) return;

            // 1. Time Logic
            const hour = new Date().getHours();
            let greeting = "Good Morning,";

            if (hour >= 12 && hour < 17) {
                greeting = "Good Afternoon,";
            } else if (hour >= 17 || hour < 5) {
                greeting = "Good Evening,";
            }

            textEl.innerText = greeting;

            // 2. Name Logic
            if (currentUser && currentUser.data && currentUser.data.full_name) {
                // Get just the first name (e.g., "Siddhant" from "Siddhant Bansod")
                nameEl.innerText = currentUser.data.full_name.split(' ')[0];
            } else {
                nameEl.innerText = "Guest";
            }
        }
        // --- LOGOUT LOGIC (Smooth & Silent) ---
        function logout() {
            // 1. Visual Feedback (Button press feel)
            const btn = event.currentTarget;
            btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> Signing out...`;

            setTimeout(() => {
                // 2. Clear Session Data
                localStorage.removeItem('paws_guest_profile');
                currentUser = null;

                // 3. Close Profile Modal Smoothly
                toggleProfile(false);

                // 4. Reset Forms (So next user sees empty fields)
                document.getElementById('auth-email').value = "";
                document.getElementById('auth-password').value = "";

                // 5. Bring back Auth Screen (Fade In)
                const authScreen = document.getElementById('auth-screen');
                authScreen.classList.remove('hidden');
                authScreen.style.opacity = '0'; // Start invisible

                // Force browser paint
                requestAnimationFrame(() => {
                    authScreen.style.transition = 'opacity 0.5s ease';
                    authScreen.style.opacity = '1'; // Fade to black
                });

                // 6. Reset Button State (Silent Reset)
                setTimeout(() => {
                    btn.innerHTML = `<i class="fa-solid fa-right-from-bracket"></i> Log Out`;
                }, 500);

            }, 600); // Small delay to make it feel "processed"
        }
        function loadUlweBackups(category) {
            if (category !== 'hospital' && category !== 'clinic') { alert("No results found."); return; }
            const ulweData = [
                { text: "Feather Touch Hospital", center: [73.0280, 18.9745] },
                { text: "Galaxy Hospital", center: [73.0295, 18.9780] },
                { text: "Apollo Clinic", center: [73.0245, 18.9752] },
                { text: "Millennium Hospital", center: [73.0310, 18.9720] }
            ];
            const bounds = new mapboxgl.LngLatBounds();
            ulweData.forEach(place => {
                const el = document.createElement('div');
                el.className = `w-4 h-4 rounded-full border-2 border-white shadow-lg bg-red-500`;
                const popup = new mapboxgl.Popup({ offset: 25, closeButton: false }).setHTML(`<b style="color:black">${place.text}</b><br><span style="color:#555;font-size:10px">Ulwe, Navi Mumbai</span>`);
                const marker = new mapboxgl.Marker(el).setLngLat(place.center).setPopup(popup).addTo(mapInstance);
                markers.push(marker);
                bounds.extend(place.center);
            });
            mapInstance.fitBounds(bounds, { padding: 80, maxZoom: 15 });
            addMessage("Used offline data (Network/API Limit).", false);
        }

        // --- 7. PROFILE & CHAT (Fixed) ---
        // --- FIXED UPDATE UI FUNCTION ---
        function updateUIWithProfile(data) {
            // 1. Basic Fields (Safe Checks)
            if (data.full_name) {
                const nameInput = document.getElementById('p-name');
                if (nameInput) nameInput.value = data.full_name;

                // Update Home Screen Header
                const headerName = document.querySelector('h1 span');
                if (headerName) headerName.innerText = data.full_name.split(' ')[0];

                // Update Greeting
                if (typeof updateHomeGreeting === "function") updateHomeGreeting();
            }

            // Safely update other fields only if they exist
            if (document.getElementById('p-age')) document.getElementById('p-age').value = data.age || '';
            if (document.getElementById('p-blood')) document.getElementById('p-blood').value = data.blood_group || 'Unknown';
            if (document.getElementById('p-meds')) document.getElementById('p-meds').value = data.medications || '';
            if (document.getElementById('p-goal')) document.getElementById('p-goal').value = data.dietary_goal || '';
            if (document.getElementById('p-location')) document.getElementById('p-location').value = data.location || '';
            if (document.getElementById('p-height')) document.getElementById('p-height').value = data.height || '';
            if (document.getElementById('p-weight')) document.getElementById('p-weight').value = data.weight || '';

            // 2. CRITICAL FIX: Handle Conditions (Tags vs Old Textbox)
            // The old code crashed here because 'p-conditions' ID is gone.

            // New Logic: Populate the Global Tags Array
            if (data.conditions && data.conditions.trim() !== "") {
                // Split string "Diabetes, Asthma" -> Array ["Diabetes", "Asthma"]
                profileSelectedConditions = data.conditions.split(', ').filter(i => i);
            } else {
                profileSelectedConditions = [];
            }

            // 3. Render the tags immediately
            if (typeof renderProfileTags === "function") renderProfileTags();
            updateHomeGreeting();
        }

        async function saveAndCloseProfile() {
            const btn = event.target;
            btn.innerText = "Saving...";

            const updates = {
                full_name: document.getElementById('p-name').value,
                age: document.getElementById('p-age').value,
                blood_group: document.getElementById('p-blood').value,

                // JOIN TAGS ARRAY INTO A STRING FOR SAVING
                conditions: profileSelectedConditions.join(", "),

                medications: document.getElementById('p-meds').value,
                dietary_goal: document.getElementById('p-goal').value,
                location: document.getElementById('p-location').value,

                // Preserve existing photo if not changed here
                photo: currentUser.data.photo
            };

            // SAVE TO LOCAL STORAGE (Guest Mode)
            localStorage.setItem('paws_guest_profile', JSON.stringify(updates));
            updateUIWithProfile(updates);

            setTimeout(() => {
                btn.innerText = "Done";
                toggleProfile(false);
            }, 500);
        }

        async function sendMessage() {
            const inputField = document.getElementById("user-input");
            const message = inputField.value.trim();
            if (message === "") return;

            addMessage(message, true);
            inputField.value = "";

            const mascotText = document.getElementById('mascot-text');
            if (mascotText) mascotText.innerText = "Let me think...";

            try {
                const response = await fetch("https://medipanda-ekck.onrender.com/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user_message: message })
                });
                const data = await response.json();
                addMessage(data.reply);
                if (mascotText) mascotText.innerText = "I found something!";
            } catch (error) {
                addMessage("I can't reach my brain right now! (Server Error)");
            }
        }

        // --- 8. HELPERS (Navigation, Camera, Etc) ---
        // --- FIXED TOGGLE FUNCTION ---
        function toggleProfile(show) {
            const modal = document.getElementById('profile-modal');
            // Select the elements that are "bleeding through"
            const home = document.getElementById('home-screen');
            const island = document.getElementById('dynamic-island');
            const askAiBtn = document.querySelector('button[onclick*="showScreen(\'chat\')"]'); // The floating blue button

            if (!modal) return;

            if (show) {
                // 1. Show the Profile Modal
                modal.classList.remove('hidden');

                // 2. Hide Background Elements (So they don't overlap)
                if (home) home.classList.add('hidden');
                if (island) island.classList.add('hidden');
                if (askAiBtn) askAiBtn.classList.add('hidden');
                setTimeout(attachProfileConditionListeners, 500);

                // 3. Slide In Animation
                requestAnimationFrame(() => {
                    modal.classList.remove('translate-x-full');
                    modal.classList.add('translate-x-0');
                });

                // 4. Load Data
                if (currentUser && currentUser.data) {
                    updateUIWithProfile(currentUser.data);
                    // 2. Load Conditions (Split string back into Array)
                    if (currentUser.data.conditions && currentUser.data.conditions.trim() !== "") {
                        profileSelectedConditions = currentUser.data.conditions.split(', ').filter(i => i);
                    } else {
                        profileSelectedConditions = [];
                    }
                    renderProfileTags();
                    setTimeout(attachProfileConditionListeners, 100);
                }
            } else {
                // 1. Slide Out Animation
                modal.classList.remove('translate-x-0');
                modal.classList.add('translate-x-full');

                // 2. Bring Back Background Elements
                if (home) home.classList.remove('hidden');
                if (island) island.classList.remove('hidden');
                if (askAiBtn) askAiBtn.classList.remove('hidden');

                // 3. Fully Hide Modal after animation finishes (300ms)
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }
        // --- PROFILE TAGGING LOGIC ---

        let profileSelectedConditions = []; // Separate array for the profile screen

        function attachProfileConditionListeners() {
    const input = document.getElementById('p-condition-search');
    const suggestionBox = document.getElementById('p-suggestions-box');
    
    if (!input || !suggestionBox) return;

    // Remove old listeners by cloning
    const newInput = input.cloneNode(true);
    input.parentNode.replaceChild(newInput, input);

    // Typing Event
    newInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        
        if (query.length < 1) { 
            suggestionBox.classList.add('hidden');
            return;
        }

        const matches = MASTER_CONDITIONS.filter(c => 
            c.toLowerCase().includes(query) && !profileSelectedConditions.includes(c)
        );

        if (matches.length > 0) {
            suggestionBox.innerHTML = matches.map(c => `
                <div onclick="addProfileTag('${c}')" 
                     class="p-3 text-white hover:bg-blue-600 cursor-pointer border-b border-white/10 text-sm font-medium transition-colors">
                    ${c}
                </div>
            `).join('');
            suggestionBox.classList.remove('hidden');
        } else {
            suggestionBox.innerHTML = `<div class="p-3 text-zinc-500 text-sm italic">No match found</div>`;
            suggestionBox.classList.remove('hidden');
        }
    });

    // Hide when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('#p-condition-search') && !e.target.closest('#p-suggestions-box')) {
            suggestionBox.classList.add('hidden');
        }
    });
}
        // 1. Initialize Listeners (Call this when Profile Opens)
        function attachProfileConditionListeners() {
            const input = document.getElementById('p-condition-search');
            const suggestionBox = document.getElementById('p-suggestions-box');

            if (!input || !suggestionBox) return;

            // Clone to remove old listeners (prevents duplicate triggers)
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);

            // INPUT EVENT: Filter the Master List
            newInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();

                // Hide if empty
                if (query.length < 1) {
                    suggestionBox.classList.add('hidden');
                    return;
                }

                // Filter Logic
                const matches = MASTER_CONDITIONS.filter(c =>
                    c.toLowerCase().includes(query) && !profileSelectedConditions.includes(c)
                );

                // Render Dropdown
                if (matches.length > 0) {
                    suggestionBox.innerHTML = matches.map(c => `
                <div onclick="addProfileTag('${c}')" 
                     class="p-3 hover:bg-blue-600/20 hover:text-blue-400 text-zinc-300 cursor-pointer border-b border-white/5 last:border-0 transition text-sm font-medium flex justify-between items-center group">
                    <span>${c}</span>
                    <i class="fa-solid fa-plus text-zinc-600 group-hover:text-blue-500"></i>
                </div>
            `).join('');
                    suggestionBox.classList.remove('hidden');
                } else {
                    suggestionBox.innerHTML = `<div class="p-3 text-zinc-500 text-sm italic">No matching condition found.</div>`;
                    suggestionBox.classList.remove('hidden');
                }
            });

            // CLICK AWAY: Hide dropdown
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#p-condition-search') && !e.target.closest('#p-suggestions-box')) {
                    suggestionBox.classList.add('hidden');
                }
            });
        }

        // 2. Add Tag
        function addProfileTag(condition) {
    if (profileSelectedConditions.includes(condition)) return;
    profileSelectedConditions.push(condition);
    renderProfileTags();
    
    // Reset Input
    const input = document.getElementById('p-condition-search');
    input.value = "";
    document.getElementById('p-suggestions-box').classList.add('hidden');
    input.focus();
}

function removeProfileTag(condition) {
    profileSelectedConditions = profileSelectedConditions.filter(c => c !== condition);
    renderProfileTags();
}

function renderProfileTags() {
    const container = document.getElementById('p-conditions-container');
    if (!container) return;

    container.innerHTML = profileSelectedConditions.map(c => `
        <div class="bg-blue-600/20 border border-blue-500/50 text-blue-400 px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs font-bold">
            <span>${c}</span>
            <button onclick="removeProfileTag('${c}')" class="hover:text-white"><i class="fa-solid fa-xmark"></i></button>
        </div>
    `).join('');
}

        function formatAIResponse(text) {
            let formatted = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>'); formatted = formatted.replace(/\n/g, '<br>'); formatted = formatted.replace(/^\* /gm, 'â€¢ '); return formatted;
        }

        function addMessage(text, isUser = false) {
            const container = document.getElementById('chat-container'); const div = document.createElement('div');
            if (isUser) { div.className = "flex items-end justify-end w-full mb-4"; div.innerHTML = `<div class="bg-blue-600 text-white rounded-2xl rounded-tr-none p-4 shadow-md max-w-[85%] fade-enter"><p class="font-bold text-sm leading-relaxed">${text}</p></div>`; }
            else { const cleanHtml = formatAIResponse(text); div.className = "flex items-start w-full mb-4"; div.innerHTML = `<div class="bg-zinc-800 border border-zinc-700 rounded-2xl rounded-tl-none p-4 shadow-sm max-w-[85%] fade-enter text-gray-200 text-sm leading-relaxed"><div>${cleanHtml}</div></div>`; }
            container.appendChild(div); setTimeout(() => { const bubble = div.querySelector('.fade-enter'); if (bubble) bubble.classList.add('fade-enter-active'); }, 10); container.scrollTop = container.scrollHeight;
        }

        function showScreen(screenName) {
            const screens = ['home-screen', 'chat-screen', 'profile-screen'];
            screens.forEach(id => { const el = document.getElementById(id); if (el) el.classList.add('hidden'); });
            const target = document.getElementById(screenName + '-screen'); if (target) target.classList.remove('hidden');
            const navBar = document.querySelector('.fixed.bottom-0'); const island = document.getElementById('dynamic-island'); const profileBtn = document.querySelector('button[onclick="showScreen(\'profile\')"]');
            if (screenName === 'home') { if (navBar) navBar.classList.remove('hidden'); if (island) island.classList.remove('hidden'); if (profileBtn) profileBtn.classList.remove('hidden'); }
            else { if (island) island.classList.add('hidden'); if (profileBtn) profileBtn.classList.add('hidden'); if (screenName === 'profile') { if (navBar) navBar.classList.add('hidden'); } else { if (navBar) navBar.classList.remove('hidden'); } }
        }

        // Camera Globals
        const island = document.getElementById('dynamic-island');
        const icon = document.getElementById('camera-icon');
        const view = document.getElementById('camera-view');
        let isExpanded = false;

        function expandCamera() {
            if (isExpanded) return; isExpanded = true;
            island.style.width = "95%"; island.style.height = "50vh"; island.style.borderRadius = "32px"; island.style.cursor = "default"; icon.style.opacity = "0";
            setTimeout(() => { view.style.opacity = "1"; view.style.pointerEvents = "auto"; document.getElementById('camera-input').click(); }, 300);
        }

        function collapseCamera(e) {
            if (e && typeof e.stopPropagation === 'function') e.stopPropagation(); isExpanded = false;
            if (view) { view.style.opacity = "0"; view.style.pointerEvents = "none"; }
            setTimeout(() => { if (island) { island.style.width = "200px"; island.style.height = "64px"; island.style.borderRadius = "9999px"; island.style.cursor = "pointer"; } if (icon) icon.style.opacity = "1"; }, 100);
        }

        // Camera Input Listener
        const cameraInput = document.getElementById('camera-input');
        if (cameraInput) {
            cameraInput.addEventListener('change', async function (e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const url = URL.createObjectURL(file);
                    const video = document.getElementById('camera-stream');
                    if (video) { video.style.backgroundImage = `url(${url})`; video.style.backgroundSize = "cover"; }
                    setTimeout(() => { collapseCamera(); showScreen('chat'); addMessage("Scanning this image...", true); }, 1000);

                    // Demo Upload Logic
                    const formData = new FormData(); formData.append("file", file); formData.append("user_id", "demo_user");
                    try {
                        const response = await fetch("https://medipanda-ekck.onrender.com/analyze", { method: "POST", body: formData });
                        const data = await response.json();
                        addMessage(data.reply);
                    } catch (error) { addMessage("I couldn't upload the image. Is the server running?"); }
                }
            });
        }
    </script>
    <button onclick="showScreen('chat')"
        class="fixed bottom-12 right-6 z-50 bg-blue-600 hover:bg-blue-500 text-white px-5 py-3 rounded-full shadow-lg font-bold flex items-center gap-2 transition-transform active:scale-95 border border-blue-400/30">
        <i class="fa-solid fa-comment-medical text-lg"></i>
        <span>Ask AI</span>
    </button>
    <div id="map-modal" class="app-transition opacity-0 pointer-events-none bg-[#09090b]">

        <div id="modal-content" class="w-full h-full relative content-hidden">

            <div
                class="absolute top-0 left-0 w-full p-6 pt-12 z-[1001] flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
                <h2 class="text-2xl font-bold text-white drop-shadow-md pointer-events-auto">Nearby Services</h2>

                <button onclick="closeMapModal()"
                    class="bg-black/50 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/10 pointer-events-auto active:scale-90 transition shadow-lg group hover:bg-zinc-800">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round"
                        class="group-hover:rotate-90 transition-transform duration-300">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div id="full-map" class="absolute inset-0 z-0 bg-[#121212]"></div>

            <div class="absolute bottom-8 left-0 w-full px-4 z-[1001] flex justify-center pointer-events-none">
                <div
                    class="bg-zinc-900/90 backdrop-blur-xl border border-white/10 p-3 rounded-3xl shadow-2xl flex gap-3 overflow-x-auto no-scrollbar pointer-events-auto max-w-sm w-full">

                    <button onclick="searchNearby('hospital')"
                        class="flex-1 min-w-[70px] bg-zinc-800/50 hover:bg-zinc-700 text-white py-3 rounded-2xl flex flex-col items-center justify-center gap-1 transition active:scale-95 border border-white/5">
                        <div class="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center mb-1"><i
                                class="fa-solid fa-hospital text-red-500 text-sm"></i></div>
                        <span class="text-[10px] font-bold text-zinc-300">Hospitals</span>
                    </button>

                    <button onclick="searchNearby('cardiologist')"
                        class="flex-1 min-w-[70px] bg-zinc-800/50 hover:bg-zinc-700 text-white py-3 rounded-2xl flex flex-col items-center justify-center gap-1 transition active:scale-95 border border-white/5">
                        <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center mb-1"><i
                                class="fa-solid fa-heart-pulse text-blue-500 text-sm"></i></div>
                        <span class="text-[10px] font-bold text-zinc-300">Cardio</span>
                    </button>

                    <button onclick="searchNearby('pharmacy')"
                        class="flex-1 min-w-[70px] bg-zinc-800/50 hover:bg-zinc-700 text-white py-3 rounded-2xl flex flex-col items-center justify-center gap-1 transition active:scale-95 border border-white/5">
                        <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center mb-1"><i
                                class="fa-solid fa-pills text-green-500 text-sm"></i></div>
                        <span class="text-[10px] font-bold text-zinc-300">Meds</span>
                    </button>

                    <button onclick="searchNearby('clinic')"
                        class="flex-1 min-w-[70px] bg-zinc-800/50 hover:bg-zinc-700 text-white py-3 rounded-2xl flex flex-col items-center justify-center gap-1 transition active:scale-95 border border-white/5">
                        <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center mb-1"><i
                                class="fa-solid fa-user-doctor text-purple-500 text-sm"></i></div>
                        <span class="text-[10px] font-bold text-zinc-300">Clinic</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>


</html>